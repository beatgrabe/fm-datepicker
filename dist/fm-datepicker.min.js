!function(){"use strict";function a(){return function(a,b){return"number"==typeof a&&(a=moment(a)),moment(a).format(b)}}function b(){return function(a,b,c){if(!(b&&c&&b.isValid()&&c.isValid()))return a;b=moment(b),c=moment(c);for(var d=b.clone();+c>=+d&&(a.push(+d),!(9999<a.length));d.add(f));return a}}function c(a){a.format=a.format||"LL",a.startDate=a.startDate||moment().startOf("month"),a.endDate=a.endDate||moment().endOf("month"),a.isOpen=a.isOpen||!1,a.style=a.style||"dropdown",a.strict=a.strict||!1,a.btnClass=a.btnClass||"btn-default",moment.tz&&(a.startDate.tz(a.timezone),a.endDate.tz(a.timezone)),a.ensureTimeIsWithinBounds=function(b){return b&&moment.isMoment(b)?b.isBefore(a.startDate)?moment(a.startDate):b.isAfter(a.endDate)?moment(a.endDate):b:b},a.ngModel=a.ensureTimeIsWithinBounds(a.ngModel),a.findActiveIndex=function(b){if(a.activeIndex=0,b&&a.startDate.isValid()&&a.endDate.isValid())for(var c=a.startDate.clone();+c<=+a.endDate&&!(9999<a.activeIndex)&&!c.isSame(b);c.add(f),++a.activeIndex)if(c.isAfter(b)){a.strict&&(a.activeIndex=-1),a.activeIndex-=1;break}},a.findActiveIndex(a.ngModel)}function d(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){a.isOpen?(a.focusInputElement(),a.closePopup()):a.focusInputElement()})}}}function e(a){return{templateUrl:"fmDatepicker.html",replace:!0,restrict:"E",scope:{ngModel:"=",format:"=?",timezone:"=?",startDate:"=?",endDate:"=?",isOpen:"=?",style:"=?",strict:"=?",btnClass:"=?"},controller:"fmDatepickerController",require:"ngModel",link:function(b,c,d,e){function h(a){e.$setValidity("time",a),e.$setValidity("bounds",a),e.$setValidity("start",a),e.$setValidity("end",a)}function i(){h(!0);var a=j(b.time);if(b.strict&&(a=a&&k(b.time)),b.startDate.isValid()||e.$setValidity("start",!1),b.endDate.isValid()||e.$setValidity("end",!1),a){var c;c=moment.tz?moment.tz(b.time,b.format,b.timezone):moment(b.time,b.format),e.$setViewValue(c),moment.tz?b.time=moment.tz(b.time,b.format,b.timezone).format(b.format):b.time=moment(b.time,b.format).format(b.format)}}function j(a){var c;return c=moment.tz?a?moment.tz(a,b.format,b.timezone):moment.invalid():a?moment(a,b.format):moment.invalid(),c.isValid()?(e.$setValidity("time",!0),!0):(e.$setValidity("time",!1),e.$setViewValue(null),!1)}function k(a){var c;return c=moment.tz?a?moment.tz(a,b.format,b.timezone):moment.invalid():a?moment(a,b.format):moment.invalid(),!c.isValid()||c.isBefore(b.startDate)||c.isAfter(b.endDate)?(e.$setValidity("bounds",!1),e.$setViewValue(null),!1):(e.$setValidity("bounds",!0),!0)}function l(){a(function(){b.$apply()}),b.isOpen&&a(m)}function m(){var a=c.find("ul");$(a).scrollTop(0);var b=$("li.active",a),d=b.length?b.position().top:0,e=b.length?b.outerHeight(!0):0;$(a).scrollTop(d-e)}function n(){b.isOpen||(b.isOpen=!0,b.modelPreview=b.ngModel?b.ngModel.clone():b.startDate.clone(),a(l))}b.$watchCollection("[startDate,endDate,strict]",function(){i()}),b.$watchCollection("[startDate,endDate,ngModel]",function(){b.findActiveIndex(b.ngModel)}),e.$render=function(){var a=moment(e.$modelValue).format(b.format),c=j(a);if(b.strict&&(c=c&&k(a)),!c)throw new Error("The provided time value is invalid.");b.time=a},b.closePopup=function(c){c?a(function(){b.isOpen=!1},200):(b.isOpen=!1,a(l))},b.handleListClick=function(a){return a.preventDefault(),!1},b.select=function(a,c){var d;d=moment.tz?moment(a).tz(b.timezone):moment(a),b.time=d.format(b.format),b.activeIndex=c,b.update(),b.closePopup()},b.increment=function(){b.isOpen?(b.modelPreview.add(f),b.modelPreview=b.ensureTimeIsWithinBounds(b.modelPreview)):(b.ngModel.add(f),b.ngModel=b.ensureTimeIsWithinBounds(b.ngModel),b.time=b.ngModel.format(b.format)),b.activeIndex=Math.min(b.largestPossibleIndex,b.activeIndex+1)},b.decrement=function(){b.isOpen?(b.modelPreview.subtract(f),b.modelPreview=b.ensureTimeIsWithinBounds(b.modelPreview)):(b.ngModel.subtract(f),b.ngModel=b.ensureTimeIsWithinBounds(b.ngModel),b.time=b.ngModel.format(b.format)),b.activeIndex=Math.max(0,b.activeIndex-1)},b.update=function(){var a=j(b.time)&&k(b.time);if(a){var c;c=moment.tz?moment.tz(b.time,b.format,b.timezone):moment(b.time,b.format),e.$setViewValue(c)}},b.handleKeyboardInput=function(c){switch(c.keyCode){case 13:b.modelPreview&&(b.ngModel=b.modelPreview,b.isOpen=!1);break;case 27:b.closePopup();break;case 33:n(),b.modelPreview.subtract(g),b.modelPreview=b.ensureTimeIsWithinBounds(b.modelPreview),b.activeIndex=Math.max(0,b.activeIndex-7);break;case 34:n(),b.modelPreview.add(g),b.modelPreview=b.ensureTimeIsWithinBounds(b.modelPreview),b.activeIndex=Math.min(b.largestPossibleIndex,b.activeIndex+7);break;case 38:n(),b.decrement();break;case 40:n(),b.increment()}a(l)},b.preventDefault=function(a){a.preventDefault()},b.largestPossibleIndexIs=function(a){b.largestPossibleIndex=a},b.focusInputElement=function(){$(o).focus()};var o=c.find("input"),p=c.find("ul");o.bind("focus",function(){a(n,150),b.isFocused=!0}),o.bind("blur",function(){a(function(){$(o).is(":focus")||(b.closePopup(),i())},150),b.isFocused=!1}),p.bind("mousedown",function(a){a.preventDefault()}),"function"==typeof Hamster&&Hamster(o[0]).wheel(function(c,d,e,f){b.isFocused&&(c.preventDefault(),b.activeIndex-=d,b.activeIndex=Math.min(b.largestPossibleIndex,Math.max(0,b.activeIndex)),b.select(b.dropDownOptions[b.activeIndex],b.activeIndex),a(l))})}}}var f=moment.duration(1,"day"),g=moment.duration(1,"week");angular.module("fmDatepicker",[]),angular.module("fmDatepicker").filter("fmDateFormat",a).filter("fmDateInterval",b).controller("fmDatepickerController",c).directive("fmDatepickerToggle",d).directive("fmDatepicker",e),c.$inject=["$scope"],e.$inject=["$timeout"]}();