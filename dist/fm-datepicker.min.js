!function(){"use strict";var a=moment.duration(1,"day");try{angular.module("fm.components")}catch(b){angular.module("fm.components",[])}angular.module("fm.components").filter("fmDateFormat",function(){return function(a,b){return"number"==typeof a&&(a=moment(a)),moment(a).format(b)}}).filter("fmDateInterval",function(){return function(b,c,d){if(!(c&&d&&c.isValid()&&d.isValid()))return b;c=moment(c),d=moment(d);for(var e=c.clone();+d>=+e&&(b.push(+e),!(9999<b.length));e.add(a));return b}}).controller("fmDatepickerController",["$scope",function(b){b.format=b.format||"LL",b.startDate=b.startDate||moment().startOf("month"),b.endDate=b.endDate||moment().endOf("month"),b.isOpen=b.isOpen||!1,b.style=b.style||"dropdown",b.strict=b.strict||!1,b.btnClass=b.btnClass||"btn-default",moment.tz&&(b.startDate.tz(b.timezone),b.endDate.tz(b.timezone)),b.ensureTimeIsWithinBounds=function(a){return a&&moment.isMoment(a)?a.isBefore(b.startDate)?moment(b.startDate):a.isAfter(b.endDate)?moment(b.endDate):a:a},b.ngModel=b.ensureTimeIsWithinBounds(b.ngModel),b.findActiveIndex=function(c){if(b.activeIndex=0,c&&b.startDate.isValid()&&b.endDate.isValid())for(var d=b.startDate.clone();+d<=+b.endDate&&!(9999<b.activeIndex)&&!d.isSame(c);d.add(a),++b.activeIndex)if(d.isAfter(c)){b.strict&&(b.activeIndex=-1),b.activeIndex-=1;break}},b.findActiveIndex(b.ngModel)}]).directive("fmDatepickerToggle",function(){return{restrict:"A",link:function(a,b,c){b.bind("click",function(){a.isOpen?(a.focusInputElement(),a.closePopup()):a.focusInputElement()})}}}).directive("fmDatepicker",["$timeout",function(b){return{template:"<div>  <div class='input-group'>    <span class='input-group-btn' ng-if='style==\"sequential\"'>      <button type='button' class='btn {{btnClass}}' ng-click='decrement()' ng-disabled='activeIndex==0'>        <span class='glyphicon glyphicon-minus'></span>      </button>    </span>    <input type='text' class='form-control' ng-model='time' ng-keyup='handleKeyboardInput($event)' ng-change='update()'>    <span class='input-group-btn'>      <button type='button' class='btn {{btnClass}}' ng-if='style==\"sequential\"' ng-click='increment()' ng-disabled='activeIndex==largestPossibleIndex'>        <span class='glyphicon glyphicon-plus'></span>      </button>      <button type='button' class='btn {{btnClass}}' ng-if='style==\"dropdown\"' ng-class='{active:isOpen}' fm-datepicker-toggle>        <span class='glyphicon glyphicon-calendar'></span>      </button>    </span>  </div>  <div class='dropdown' ng-if='style==\"dropdown\"' ng-class='{open:isOpen}'>    <ul class='dropdown-menu form-control' style='height:auto; max-height:160px; overflow-y:scroll;' ng-mousedown=\"handleListClick($event)\">      <li ng-repeat='time in ( $parent.dropDownOptions = ( [] | fmDateInterval:startDate:endDate ) )' ng-click='select(time,$index)' ng-class='{active:(activeIndex==$index)}'>        {{$last?largestPossibleIndexIs($index):angular.noop()}}        <a href='#' ng-click='preventDefault($event)'>{{time|fmDateFormat:format}}</a>      </li>    </ul>  </div></div>",replace:!0,restrict:"E",scope:{ngModel:"=",format:"=?",timezone:"=?",startDate:"=?",endDate:"=?",isOpen:"=?",style:"=?",strict:"=?",btnClass:"=?"},controller:"fmDatepickerController",require:"ngModel",link:function(c,d,e,f){function g(a){f.$setValidity("time",a),f.$setValidity("bounds",a),f.$setValidity("start",a),f.$setValidity("end",a)}function h(){g(!0);var a=i(c.time);if(c.strict&&(a=a&&j(c.time)),c.startDate.isValid()||f.$setValidity("start",!1),c.endDate.isValid()||f.$setValidity("end",!1),a){var b;b=moment.tz?moment.tz(c.time,c.format,c.reference.tz()):moment(c.time,c.format),f.$setViewValue(b),moment.tz?c.time=moment.tz(c.time,c.format,c.reference.tz()).format(c.format):c.time=moment(c.time,c.format).format(c.format)}}function i(a){var b;return b=moment.tz?a?moment.tz(a,c.format,c.reference.tz()):moment.invalid():a?moment(a,c.format):moment.invalid(),b.isValid()?(f.$setValidity("time",!0),!0):(f.$setValidity("time",!1),f.$setViewValue(null),!1)}function j(a){var b;return b=moment.tz?a?moment.tz(a,c.format,c.reference.tz()):moment.invalid():a?moment(a,c.format):moment.invalid(),!b.isValid()||b.isBefore(c.startDate)||b.isAfter(c.endDate)?(f.$setValidity("bounds",!1),f.$setViewValue(null),!1):(f.$setValidity("bounds",!0),!0)}function k(){b(function(){c.$apply()}),c.isOpen&&b(l)}function l(){var a=d.find("ul");$(a).scrollTop(0);var b=$("li.active",a),c=b.length?b.position().top:0,e=b.length?b.outerHeight(!0):0;$(a).scrollTop(c-e)}function m(){c.isOpen||(c.isOpen=!0,c.modelPreview=c.ngModel?c.ngModel.clone():c.startDate.clone(),b(k))}c.$watchCollection("[startDate,endDate,strict]",function(){h()}),c.$watchCollection("[startDate,endDate,ngModel]",function(){c.findActiveIndex(c.ngModel)}),f.$render=function(){var a=moment(f.$modelValue).format(c.format),b=i(a);if(c.strict&&(b=b&&j(a)),!b)throw new Error("The provided time value is invalid.");c.time=a},c.closePopup=function(a){a?b(function(){c.isOpen=!1},200):(c.isOpen=!1,b(k))},c.handleListClick=function(a){return a.preventDefault(),!1},c.select=function(a,b){var d;d=moment.tz?moment(a).tz(c.reference.tz()):moment(a),c.time=d.format(c.format),c.activeIndex=b,c.update(),c.closePopup()},c.increment=function(){c.isOpen?(c.modelPreview.add(a),c.modelPreview=c.ensureTimeIsWithinBounds(c.modelPreview)):(c.ngModel.add(a),c.ngModel=c.ensureTimeIsWithinBounds(c.ngModel),c.time=c.ngModel.format(c.format)),c.activeIndex=Math.min(c.largestPossibleIndex,c.activeIndex+1)},c.decrement=function(){c.isOpen?(c.modelPreview.subtract(a),c.modelPreview=c.ensureTimeIsWithinBounds(c.modelPreview)):(c.ngModel.subtract(a),c.ngModel=c.ensureTimeIsWithinBounds(c.ngModel),c.time=c.ngModel.format(c.format)),c.activeIndex=Math.max(0,c.activeIndex-1)},c.update=function(){var a=i(c.time)&&j(c.time);if(a){var b;b=moment.tz?moment.tz(c.time,c.format,c.reference.tz()):moment(c.time,c.format),f.$setViewValue(b)}},c.handleKeyboardInput=function(a){switch(a.keyCode){case 13:c.modelPreview&&(c.ngModel=c.modelPreview,c.isOpen=!1);break;case 27:c.closePopup();break;case 33:m(),c.modelPreview.subtract(c.largeInterval),c.modelPreview=c.ensureTimeIsWithinBounds(c.modelPreview),c.activeIndex=Math.max(0,c.activeIndex-c.largeIntervalIndexJump);break;case 34:m(),c.modelPreview.add(c.largeInterval),c.modelPreview=c.ensureTimeIsWithinBounds(c.modelPreview),c.activeIndex=Math.min(c.largestPossibleIndex,c.activeIndex+c.largeIntervalIndexJump);break;case 38:m(),c.decrement();break;case 40:m(),c.increment()}b(k)},c.preventDefault=function(a){a.preventDefault()},c.largestPossibleIndexIs=function(a){c.largestPossibleIndex=a},c.focusInputElement=function(){$(n).focus()};var n=d.find("input"),o=d.find("ul");n.bind("focus",function(){b(m,150),c.isFocused=!0}),n.bind("blur",function(){b(function(){$(n).is(":focus")||(c.closePopup(),h())},150),c.isFocused=!1}),o.bind("mousedown",function(a){a.preventDefault()}),"function"==typeof Hamster&&Hamster(n[0]).wheel(function(a,d,e,f){c.isFocused&&(a.preventDefault(),c.activeIndex-=d,c.activeIndex=Math.min(c.largestPossibleIndex,Math.max(0,c.activeIndex)),c.select(c.dropDownOptions[c.activeIndex],c.activeIndex),b(k))})}}}])}();